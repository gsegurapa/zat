<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Flightstats Active Flight Picker</title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.js"></script>
<style>
	body {
	  font-family: Tahoma, Geneva, sans-serif;
	  font-size: 1em;
	}
</style>
</head>
<body>
<div id="top">
Departing airport:
<input id="aircode" type="text" size="4" value="PDX" />
<input id="lookup" type="button" value="Lookup" />
</div>
<div id="out">
<table id="flights">
</table>
</div>
<script type="text/javascript">
(function($){
	var airportCode = 'PDX',
			appId = 'ebc6552f',
			appKey = 'NACIS';

	$('#aircode').select();

	$('#lookup').on('click', lookup);
	$('#aircode').on('keydown', lookup);

	function lookup(e) {
		if (e.type === 'keydown' && e.keyCode !== 13) { return; }
		airportCode = $('#aircode').val().toUpperCase();
		$.ajax({  // airport tracks departures
      url: 'https://api.flightstats.com/flex/flightstatus/rest/v2/jsonp/airport/tracks/' + airportCode + '/dep',
      data: { appId: appId, appKey: appKey, maxPositions: 2, includeFlightPlan: true },
      dataType: 'jsonp',
      success: getDepartures
    });
	}

	function getDepartures(data, status, xhr) {
		var $flights = $('#flights');
		$flights.empty();
		if (!data || data.error) {
			$flights.text('AJAX error: '+data.error.errorMessage)
			return;
		}
		$flights.append('<tr><td>ID</td><td>FLIGHT</td><td>TO</td><td>LEAVES</td></tr>');
		$.each(data.flightTracks, function(index, val) {
			$flights.append('<tr><td><a href="index.html?id='+val.flightId+
				'&airline='+val.carrierFsCode+'&flight='+val.flightNumber+'">'+val.flightId+'</a></td><td>'+
				val.carrierFsCode+'-'+val.flightNumber+'</td><td>'+val.arrivalAirportFsCode+
				'</td><td>'+val.departureDate.dateLocal.slice(0,16)+
				'</td><td><a href="http://www.flightstats.com/go/InternalAPI/singleFlightTracker.do?id='+
				val.flightId+'&airlineCode='+val.carrierFsCode+'&flightNumber='+val.flightNumber+
				'&version=1.0&key=49e3481552e7c4c9%253A-5b147615%253A12ee3ed13b5%253A-5f90&responseType=jsonp" target="_blank">chris data</a></td></tr>');
		});
	}
}(jQuery));
</script>
</body>
</html>
